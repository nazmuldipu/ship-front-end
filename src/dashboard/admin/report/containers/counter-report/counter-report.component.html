<div class="container-fluid d-print-none">
  <span class="row px-3 details-title text-left">Counter Report</span>
</div>

<div class="container-fluid">
  <div class="row d-print-none bg-light shadow-sm">
    <div class="col-auto">
      <div class="form-group">
        <label for="counterType">Counter Type</label>
        <select class="form-control" id="counterType" (change)="getUserListByRole($event.target.value)">
          <option value=""> Select a counterType </option>
          <option value="admin"> Hotelswave </option>
          <option value="Agent"> Hotelswave Agent </option>
          <option value="Service Admin"> Ship Admin </option>
          <option value="Service Agent"> Ship Agent </option>
        </select>
      </div>
    </div>
    <div class="col-auto">
      <div class="form-group">
        <label for="counter">Counter</label>
        <select class="form-control" id="counterType" (change)="onCounterChange($event.target.value)">
          <option value=""> Select a Counter </option>
          <option *ngFor="let user of userList" [value]="user.id"> {{user.name}}[{{user.phoneNumber}}] </option>
        </select>
      </div>
    </div>
    <div class="col-auto">
      <div class="form-group">
        <label for="dateRange">Date Range</label>
        <input type="text" class="form-control" id="dateRange" name="daterangeInput" daterangepicker [options]="options"
          (selected)="selectedDate($event)" />
      </div>
    </div>
    <div class="col-auto">
      <label for="reportType">Report Type</label>
      <div class="input-group mb-2">
        <select class="form-control" id="reportType" [(ngModel)]="reportType" (change)="clear()">
          <option value="Sells"> By Sells </option>
          <option value="Reservation"> By Journey Date </option>
        </select>
      </div>
    </div>

    <div class="col-auto">
      <div class="form-group">
        <label for="counter">Ship</label>
        <select class="form-control" id="counterType" (change)="onShipChange($event.target.value)">
          <option value=""> Select a Ship </option>
          <option *ngFor="let ship of shipList" [value]="ship.id"> {{ship.shipNumber}}-{{ship.name}} </option>
        </select>
      </div>
    </div>
    <div class="d-flex align-items-center" *ngIf="!!counter && !!ship">
      <button class="btn btn-sm btn-success" (click)="onSearch()">Search</button>
    </div>
    <div class="d-flex align-items-center ml-auto mr-2">
      <button class="btn btn-sm btn-primary" (click)="onPrint()">
        <i class="fa fa-print"></i> Print</button>
    </div>
  </div>
  <loading></loading>

  <ng-container *ngIf="!loading; else showLoding">
    <div class="row mb-5 mx-2" *ngIf="reportList && reportList.length>0; else noRecord">
      <div class="col-12">
        <h4 class="text-center">{{reportType}} report of {{counter.name}} from {{daterange.startDate|date}} to
          {{daterange.endDate|date}} for {{ship.shipNumber}}-{{ship.name}}</h4>
      </div>
      <table class="table table-bordered table-hover table-responsive-sm">
        <thead>
          <tr>
            <th>Sl.</th>
            <th>Ticket no.</th>
            <th>Sells Date</th>
            <th>Journey Date</th>
            <th>Passenger Info</th>
            <th>Seats</th>
            <th>Price</th>
            <th>Commission</th>
            <th>Route</th>
            <th>Sold By</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let report of reportList; index as i">
            <td>{{ i + 1 }}</td>
            <td>{{ report.bookingId }}</td>
            <td>{{ report.bookingDate | date: 'MMM d, y, h:mm:ss a' }}</td>
            <td>{{ report.journeyDate | date }}</td>
            <td>{{ report.customerName }} - {{ report.customerPhone }}</td>
            <td>
              <span *ngFor="let seat of report.seatNumbers">{{ seat }},
              </span>
            </td>
            <td>{{ report.price }}</td>
            <td>{{ report.hotelswaveCommission + report.hotelswaveAgentCommission + report.shipAgentCommission }} </td>
            <td>{{ report.shipNumber }}</td>
            <td>{{ report.soldBy }}</td>
            <td>{{ report.bookingStatus }}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>TOTAL</td>
            <td>
              <strong> {{ total.totalrent }} </strong>
            </td>
            <td>
              <strong>{{ total.totalCommission }}</strong>
            </td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tfoot>
      </table>

      <table class="table table-bordered table-hover table-responsive-sm mt-4">
        <tr>
          <th>Counter Name</th>
          <th>No of seat sold / Reserved</th>
          <th>Price</th>
          <th>Hotelswave Commission</th>
          <th>Hotelswave Agent Commission</th>
          <th>Ship Agent Commission</th>
        </tr>
        <tr *ngFor="let item of (soldBy | keyvalue)">
          <td>{{item.key}}</td>
          <td>{{item.value.totalSeatNumber}}</td>
          <td>{{item.value.price}}</td>
          <td>{{item.value.hotelswaveCommission}}</td>
          <td>{{item.value.hotelswaveAgentCommission}}</td>
          <td>{{item.value.shipAgentCommission}}</td>
        </tr>
      </table>
    </div>
    <ng-template #noRecord>
      <h4 class="text-center">
        <i class="fa fa-frown-o"></i> No record yet
      </h4>
    </ng-template>
  </ng-container>
  <ng-template #showLoding>
    <loading></loading>
  </ng-template>
</div>